<html>
    <head>
        <link rel="stylesheet" href="bootstrap.min.css">
        <script src="jquery.min.js"></script>
        <link rel="stylesheet" href="bootstrap.css">
        <script >
            function Auth() {
                var request = $.ajax({
                    url: "http://192.168.0.105:3000/session",
                    type: "GET",
                    xhrFields: {
                        withCredentials: true
                    }
                });
                request.done(function(msg) {
                    if (msg['role'] == "Interviewer" || msg['role'] == "Interviewee") {
                        window.location = "userProfile.html";
                    } else if (msg['role'] == "admin") {
                    }
                    //window.location = "profilepage.html";
                });
                request.fail(function(jqXHR, textStatus) {
                    alert("Unable to Authenticate");
                });
            }
            function getData () {
            var url = document.URL;
            var hash = url.substring(url.indexOf('#')+1);
            getEventData(hash);
            console.log(hash);
            }
            function getEventData(eventName) {
                var link = "http://192.168.0.105:3000/events/";
                link = link.concat(eventName);
                console.log(link);
                var request = $.ajax({
                    url: link,
                    type: "GET",
                    xhrFields: {
                        withCredentials: true
                    }
                });
                request.done(function(msg) {
                    setData(msg);
                });

                request.fail(function(jqXHR, textStatus) {
                });
            }
            function setData (comp) {
                document.getElementById("inputEventName").value = comp.name;
                var details = comp.details;
                console.log(details);
                document.getElementById("inputEventPointerCriteria").value = details['Pointer Criteria'];
                $('#inputStartDate').val(details['Starting Date']);
                $('#inputEndingDate').val(details['Ending Date']);
                $('#inputTextarea').val(details['Details']);
                console.log(details['Details']);
                 // var crit = "{'saas': { 'description' : '987', 'min' : 4, 'max' : '87'}, 'abc': { 'description' : 'lgl,j', 'min' : 3, 'max' : '789'}}";
                console.log(comp.criteria.length);
                // var table = document.getElementById("dataTable");
/*                for (var i = 0; i < comp.criteria.length; i++) {
                    addRow("dataTable");
                    var data = comp.criteria[i];
                        var rowDisAmt = $(table.rows.item(i).cells[0]).find('inputCriteriaType').val(data[0]);
                        var rowDisAmt = $(table.rows.item(i).cells[1]).find('inputMinVal').val(data[1]);
                        var rowDisAmt = $(table.rows.item(i).cells[2]).find('inputMaxVal').val(data[2]);
                        var rowDisAmt = $(table.rows.item(i).cells[3]).find('inputDescription').val(data[3]);
                }
            }
            var table = document.getElementById("dataTable");
            var column_count = table.rows[0].cells.length;
            var row = table.rows[0];
            if(column_count>0){
                for(var index = 0; index < comp.criteria.length;index++){
                    addRow("dataTable");
                    var data = comp.criteria[index];
                    console.log(table.rows[0].cells[0].getElementsByName('inputDescription').value);
            //Or marks[index] = document.getElementsByName('inputcell' + index)[0].value;
                }
            }*/
            for(var index = 0; index < comp.criteria.length;index++){
                addRow("dataTable");
            }
            var x = document.getElementsByClassName('myid1');
            // console.log(x.length);
            for(i = 0; i < x.length-1; i++) {
                var data = comp.criteria[i];
                // console.log(data[1]);
                x[i].value = data[0];
            }
            var x = document.getElementsByClassName('myid2');
            // console.log(x.length);
            for(i = 0; i < x.length-1; i++) {
                var data = comp.criteria[i];
                // console.log(data[1]);
                x[i].value = data[1];
            }
             var x = document.getElementsByClassName('myid3');
            // console.log(x.length);
            for(i = 0; i < x.length-1; i++) {
                var data = comp.criteria[i];
                // console.log(data[1]);
                x[i].value = data[2];
            }
             var x = document.getElementsByClassName('myid4');
            // console.log(x.length);
            for(i = 0; i < x.length-1; i++) {
                var data = comp.criteria[i];
                // console.log(data[1]);
                x[i].value = data[3];
            }
            document.getElementById("dataTable").deleteRow(x.length-1);
        }
             window.onpaint = getData();
        </script>
        <script language="javascript">
            function addRow(tableID) {
                var table = document.getElementById(tableID);
                var rowCount = table.rows.length;
                var row = table.insertRow(rowCount);
                var colCount = table.rows[0].cells.length;
                for (var i = 0; i < colCount; i++) {
                    var newcell = row.insertCell(i);
                    newcell.innerHTML = table.rows[0].cells[i].innerHTML;
                    switch (newcell.childNodes[0].type) {
                        case"text":
                            newcell.childNodes[0].value = "";
                            break;
                        case"number":
                            newcell.childNodes[0].value = "";
                            break;
                    }
                }
            }
            function deleteRow(r) {
                var table = document.getElementById("dataTable");
                var rowCount = table.rows.length;
                if (rowCount > 1) {
                    var i = r.parentNode.parentNode.rowIndex;
                    document.getElementById("dataTable").deleteRow(i);
                }
                else {
                    alert("Atleast one criteria required");
                }
            }
            </script>
        <script type="text/javascript">
            function cancleEvent() {
                window.location = "adminProfile.html";
            }
        </script>
        <script type="text/javascript">
            function submitValue() {
               var arrCriteriaType = $("input[id='inputCriteriaType']")
                            .map(function() {
                                return $(this).val();
                            }).get();
                    var arrMinVal = $("input[id='inputMinVal']")
                            .map(function() {
                                return $(this).val();
                            }).get();
                    var arrMaxVal = $("input[id='inputMaxVal']")
                            .map(function() {
                                return $(this).val();
                            }).get();
                    var arrDescription = $("input[id='inputDescription']")
                            .map(function() {
                                return $(this).val();
                            }).get();
                    
                    var data =[];


                    for (var i = arrCriteriaType.length - 1; i >= 0; i--) {
                        var tmp=[];
                        tmp[tmp.length] = arrCriteriaType[i];
                        tmp[tmp.length] = arrMinVal[i];
                        tmp[tmp.length] = arrMaxVal[i];
                        tmp[tmp.length] = arrDescription[i];
                        data[data.length] = tmp;
                    }
                    var url = document.URL;
                    var hash = url.substring(url.indexOf('#')+1)
                    //data = data+"]";
                    console.log(JSON.stringify(data));
                    
                    var request = $.ajax({
                        
                        url: "http://192.168.0.105:3000/events/" + hash,
                        type: "PATCH",
                        data: JSON.stringify({
                            'name': $('#inputEventName').val(),
                            'criteria': JSON.stringify(data),
                            'details': {'Starting Date': $('#inputStartDate').val(), 'Ending Date': $('#inputEndingDate').val(), 'Pointer Criteria': $('#inputEventPointerCriteria').val(), 'Details': $('#inputTextarea').val()}

                        }),
                        dataType: 'json',
                        contentType: 'application/json',
                        xhrFields: {
                            withCredentials: true
                        }
                    });
                    request.done(function(msg) {
                        if(msg.updated)
                            window.location = "adminProfile.html";
                    });

                    request.fail(function(jqXHR, textStatus) {
                        console.log(jqXHR, textStatus);
                        alert("Please enter correct info.");
                    });
            }
        </script>
        

        <script>
        function uploadData(msg){
            var eventName = document.getElementById("inputEventName");
            var pointerCriteria = document.getElementById("inputEventPointerCriteria");
            var startDate = document.getElementById("inputStartDate");
            var endingDate = document.getElementById("inputEndingDate");
            var eventDetails = document.getElementById("inputEventDetails");

            eventName.value = msg["name"];
            pointerCriteria.value = msg["pointerCriteria"];
            startDate.value = msg["details"]["Starting Date"];
            endingDate.value = msg["details"]["Ending Date"];
            eventDetails.value = msg["details"];
        }
        </script>
    </head>
    <body>

    <div class="well well-sm text-center" style="background-color:#173245; padding-left:8%">
      <div><h1 style="color:white">Interview Platform - Administrator
        <a href="interview_platform.html" class="btn btn-primary btn-lg" id="signOut" style="float:right">Sign Out</span></a> 
      </h1></div>
    </div>  

    <div class="container col-md-12" style="padding-top:2%; padding-left:2%; padding-right:5%">
      <div class="row">
      <div class="col-md-2">
        <ul class="nav nav-list nav-stacked">
          <li class="nav-header" style="font-size:20px"><b>Quick Links</b></li>
          <li>
            <a href="adminProfile.html">Profile</a>
          </li>
          <li><a href="pastEvents.html">Event History </a>
          </li>
          <li><a href="Create_Event.html">Create Event</a>
          </li>
          
          <li><a href="schedule.html">Schedule Interview</a>
          </li>
          <li><a href="changePassword_admin.html">Change Password </a>
          </li>
        </ul>
    </div>

    <div class="panel panel-primary" style="margin: 0 auto; margin-bottom:5%; width:80%; float:left">
        <div class="panel-heading" >
          <div class="panel-title text-center"><h3>Edit Event</h3></div>
        </div>
        <div class="panel-body" style="background:#E8EFF7;">
           <form class="form-horizontal">
            <fieldset>
                <div class="form-group">
                    <label for="inputEventName" class="col-lg-2 control-label">Event Name</label>
                    <div class="col-lg-3">
                        <input type="text" class="form-control" id="inputEventName">
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEventCriteria" class="col-lg-2 control-label">Event Criteria</label>
                    <div class="col-lg-9">
                        <a href="#" class="btn btn-primary" onclick="addRow('dataTable')">Add New Criteria</a>
                        <table class="table table-striped table-hover " id="dataTable">
                            <tbody>
                                <tr>
                                    <td class="form-group col-lg-3">
                                            <input class="form-control myid1" type="text" id="inputCriteriaType" placeholder="Criteria Type">
                                        </td>
                                    <td class="form-group col-lg-2">
                                            <input class="form-control myid2" type="number" id="inputMinVal" placeholder="Min Val">
                                        </td>
                                    <td class="form-group col-lg-2">
                                            <input class="form-control myid3" type="number" id="inputMaxVal" placeholder="Max Val">
                                        </td>
                                    <td class="form-group col-lg-5">
                                            <textarea class="form-control myid4" type="text" id="inputDescription" placeholder="Criteria Description"></textarea>
                                        </td>
                                    <td>
                                        <a href="#" class="btn btn-danger" onclick="deleteRow(this)">Delete</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table> 
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEventPointerCriteria" class="col-lg-2 control-label">Pointer Criteria</label>
                    <div class="col-lg-1">
                        <input type="number" class="form-control" id="inputEventPointerCriteria" min="0" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-2 control-label">Starting From</label>
                    <div class="col-lg-3">
                        <input type="date" class="form-control" id="inputStartDate" max="2050-12-31" min="2000-01-01" placeholder="dd/mm/yyyy">
                    </div>
                    <label class="col-lg-2 control-label">Ending Date</label>
                    <div class="col-lg-3">
                        <input type="date" class="form-control" id="inputEndingDate" max="2050-12-31" min="2000-01-01">
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputTextarea" class="col-lg-2 control-label">Details</label>
                    <div class="col-lg-9">
                        <textarea class="form-control" rows="3" id="inputTextarea"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-lg-9 col-lg-offset-2">
                        <button type="reset" class="btn btn-default" onclick="cancleEvent()">Cancel</button>
                        <button type="button" class="btn btn-primary" id="inputSubmit" onclick="submitValue()">Submit</button>
                    </div>
                </div>
            </fieldset>
        </form>
        </div>
    </div>
       
    </body>
</html>